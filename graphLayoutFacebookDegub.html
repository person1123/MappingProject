<!DOCTYPE html>
<meta charset="utf-8">
<style>

.node circle {
  cursor: pointer;
  stroke: #3182bd;
  stroke-width: 1.5px;
}

.node text {
  font: 10px sans-serif;
  pointer-events: none;
  text-anchor: middle;
}

line.link {
  fill: none;
  stroke: #9ecae1;
  stroke-width: 1.5px;
}

</style>
<body>
	<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '395526550605118',
      xfbml      : true,
      version    : 'v2.2'
    });
     
	Login();
  };

   
   
   var fbGroupID = 1429858223938188; //ID of DCC Delta and Epsilon Classes group
   var ErickaId = 832555320099806;
   var SarahId = 783029035098729;
   
   var nodes = [];
   var links = [];
   
   function Login()
    {
 
        FB.login(function(response) {
           if (response.authResponse) 
           {
           		FB.api('/783029035098729/friends/',function(response){
           			console.log("aaaah");
           			console.log(response);
           		});
                getUserInfo(); // Get User Information.
 
            } else
            {
             console.log('Authorization failed.');
            }
         },{scope: 'user_friends'});
 
    }
    
    function getUserInfo() {
       FB.api(''+fbGroupID+'/members', function(response) {
 
 		nodes = response.data;
 		console.log(response);
 		
 		for (var i = 0; i < nodes.length; i++) {
 			for (var j = 0; j < i; j++) {
 				var count = compare(nodes[i], nodes[j]);
 				
 				if (count>=0) {
 					links.append({source: i,
 						target: j,
 						strength: count});
 				}
 			}
 		}
 		
 		//compare(response.data[27],response.data[17]);
 		//compare({id: ErickaId, name:"Ecrick"},{id: SarahId, name:"Srah"});
        //response.name       - User Full name
        //response.link       - User Facebook URL
        //response.username   - User name
        //response.id         - id
        //response.email      - User email
 
        });
   }
   
   function compare(user1, user2) {
   	   var count = -1;
       FB.api(''+user1.id+'/friends/', function(friends1) {
       		if (friends1.error)
       			return;
              
       		FB.api(''+user2.id+'/friends/', function(friends2) {
       			if (friends2.error)
       				return;
       			count = 0;
       			
       			console.log("f1:");
       			console.log(friends1);
       			console.log("f2:");
       			console.log(friends1);
       			
       			for (friend1_idx in friends1.data) {
       				var friend1 = friends1.data[friend1_idx];
       				for (friend2_idx in friends2.data) {
       					var friend2 = friends2.data[friend2_idx];
       					if (friend1.id==friend2.id) {
       						//console.log("Shared friend: "+friend1.name);
       						count++;
       					}
       				}
       			}
       		});
       });
       return count;
   }
   
   function Logout()
	{
    	FB.logout(function(){document.location.reload();});
	}
	
	
  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
//     js.src = "//connect.facebook.net/en_US/sdk.js";
     js.src = "http://connect.facebook.net/en_US/sdk/debug.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
	
</script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>

var width = 960,
    height = 500,
    root;

var force = d3.layout.force()
    .linkDistance(80)
    .charge(-120)
    .gravity(.05)
    .size([width, height])
    .on("tick", tick);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var link = svg.selectAll(".link"),
    node = svg.selectAll(".node");

/*d3.json("graph.json", function(error, json) {
  root = json;
  update();
});*/

function update() {
  var nodes = flatten(root),
      links = d3.layout.tree().links(nodes);

  // Restart the force layout.
  force
      .nodes(nodes)
      .links(links)
      .start();

  // Update links.
  link = link.data(links, function(d) { return d.target.id; });

  link.exit().remove();

  link.enter().insert("line", ".node")
      .attr("class", "link");

  // Update nodes.
  node = node.data(nodes, function(d) { return d.id; });

  node.exit().remove();

  var nodeEnter = node.enter().append("g")
      .attr("class", "node")
      .on("click", click)
      .call(force.drag);

  nodeEnter.append("circle")
      .attr("r", function(d) { return Math.sqrt(d.size) / 10 || 4.5; });

  nodeEnter.append("text")
      .attr("dy", ".35em")
      .text(function(d) { return d.name; });

  node.select("circle")
      .style("fill", color);
}

function tick() {
  link.attr("x1", function(d) { return d.source.x; })
      .attr("y1", function(d) { return d.source.y; })
      .attr("x2", function(d) { return d.target.x; })
      .attr("y2", function(d) { return d.target.y; });

  node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
}

function color(d) {
  return d._children ? "#3182bd" // collapsed package
      : d.children ? "#c6dbef" // expanded package
      : "#fd8d3c"; // leaf node
}

// Toggle children on click.
function click(d) {
  if (d3.event.defaultPrevented) return; // ignore drag
  if (d.children) {
    d._children = d.children;
    d.children = null;
  } else {
    d.children = d._children;
    d._children = null;
  }
  update();
}

// Returns a list of all nodes under the root.
function flatten(root) {
  var nodes = [], i = 0;

  function recurse(node) {
    if (node.children) node.children.forEach(recurse);
    if (!node.id) node.id = ++i;
    nodes.push(node);
  }

  recurse(root);
  return nodes;
}

</script>
</body>